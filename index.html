<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rotating Tetrahedron â€” VHS</title>
<style>
/* base */
:root{--bg:#000;--fg:#e9e9e9}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:monospace;overflow:hidden}
a{color:inherit}

/* page layout */
.wrapper{height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:12px}
#timer{font-size:1rem;opacity:.85}
#container{width:300px;height:360px;border:1px solid rgba(255,255,255,.12);position:relative;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:10px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,.02), transparent)}
#scene-container{width:100%;flex:1;display:flex;align-items:center;justify-content:center;position:relative}
canvas{width:100%;height:100%;display:block}

/* inputs & text */
#password-box{width:60%;margin-top:6px}
input[type=password]{width:100%;padding:6px;font-size:.85rem;background:transparent;border:1px solid rgba(255,255,255,.18);color:var(--fg);outline:none;box-sizing:border-box}
#bottom-left-symbol{position:absolute;bottom:10px;left:10px;font-size:1.5rem;opacity:.8;pointer-events:none}
#bottom-text{font-size:.9rem;opacity:.8}
#next-page-container{width:300px;height:360px;border:1px solid rgba(255,255,255,.12);padding:15px;box-sizing:border-box;color:var(--fg);font-family:monospace;line-height:1.4;position:relative;overflow:hidden;background:linear-gradient(180deg, rgba(255,0,0,.01), rgba(0,0,0,0))}

/* VHS overlays - global */
.vhs-overlay,
.vhs-glitch,
.vhs-scanlines,
.vhs-static,
.vhs-chroma { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; mix-blend-mode:screen; }

/* scanlines */
.vhs-scanlines{
  background: repeating-linear-gradient(
    0deg,
    rgba(255,255,255,0.02) 0px,
    rgba(255,255,255,0.02) 1px,
    transparent 1px,
    transparent 2px
  );
  opacity: .06;
  animation: scan-flicker 0.16s infinite;
}
@keyframes scan-flicker{0%{opacity:.03}50%{opacity:.08}100%{opacity:.03}}

/* subtle chromatic RGB split layers */
.vhs-chroma{
  background: linear-gradient(90deg, rgba(255,0,0,.03), rgba(0,255,0,.03), rgba(0,0,255,.03));
  mix-blend-mode:screen;
  opacity:.7;
  filter:contrast(1.1) saturate(1.2);
  animation: chroma-shift 3s infinite linear;
}
@keyframes chroma-shift{
  0%{transform:translate3d(0,0,0) scale(1)}
  25%{transform:translate3d(-1.5px,0.5px,0) scale(1.001)}
  50%{transform:translate3d(1.5px,-1px,0) scale(1)}
  75%{transform:translate3d(-1px,1.5px,0) scale(1.001)}
  100%{transform:translate3d(0,0,0) scale(1)}
}

/* glitch red/green/blue split "streaks" using gradients and masks */
.vhs-glitch{
  background:
    linear-gradient(90deg, rgba(255,0,0,.06), transparent 10%),
    linear-gradient(90deg, transparent 40%, rgba(0,255,0,.04) 60%, transparent 70%),
    linear-gradient(90deg, transparent 80%, rgba(0,0,255,.05));
  opacity:.9;
  mix-blend-mode:screen;
  animation: glitch-jitter 2.2s infinite;
  transform-origin:center;
}
@keyframes glitch-jitter{
  0%{clip-path:inset(0 0 0 0);transform:translate3d(0,0,0);opacity:.9}
  10%{clip-path:inset(10% 0 70% 0);transform:translate3d(-2px,1px,0) skewX(-1deg);opacity:.75}
  25%{clip-path:inset(60% 0 10% 0);transform:translate3d(2px,-1px,0) skewX(1deg);opacity:.85}
  40%{clip-path:inset(0 0 40% 0);transform:translate3d(-1px,2px,0)}
  60%{clip-path:inset(5% 0 5% 0);transform:translate3d(0,0,0)}
  100%{clip-path:inset(0 0 0 0);transform:translate3d(0,0,0)}
}

/* static noise (animated) */
.vhs-static{
  background-image: repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 1px, transparent 1px 2px),
                    repeating-linear-gradient(90deg, rgba(255,255,255,.015) 0 1px, transparent 1px 2px);
  opacity:.05;
  animation: static-move 0.6s steps(3) infinite;
}
@keyframes static-move{0%{background-position:0 0, 0 0}100%{background-position: 40px 40px, -40px -20px}}

/* heavy vertical tape lines occasionally */
.vhs-vertical-lines{
  position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;
  background-image: linear-gradient(90deg, rgba(255,255,255,.02) 0 1px, transparent 1px 4px);
  opacity:.03; animation: vertical-pulse 5s linear infinite;
}
@keyframes vertical-pulse{0%{opacity:.03}50%{opacity:.06}100%{opacity:.03}}

/* rolling frame jitter (small whole-screen shakes) */
@keyframes frame-jitter{
  0%{transform:translate3d(0,0,0)}
  10%{transform:translate3d(-2px,1px,0) skewY(.3deg)}
  20%{transform:translate3d(1px,-1px,0)}
  30%{transform:translate3d(-1px,1px,0)}
  100%{transform:translate3d(0,0,0)}
}
.jitter{animation:frame-jitter 3.2s infinite;}

/* subtle vignette */
.vhs-vignette{
  position:absolute;inset:0;pointer-events:none;background:radial-gradient(ellipse at center, transparent 35%, rgba(0,0,0,.65) 100%);opacity:.5;
}

/* subtle colour bleed / bloom when red changed */
.red-glow-canvas{filter:drop-shadow(0 0 12px rgba(255,0,0,.25))}

/* accessibility for small screens */
@media (max-width:420px){
  #container,#next-page-container{width:92%;height:56vh}
  .wrapper{gap:8px;padding:8px}
}
</style>
</head>
<body>
<div class="wrapper">
  <div id="timer">00:00:00</div>

  <div id="container" class="jitter">
    <div id="scene-container">
      <canvas id="scene"></canvas>
      <!-- overlays local to scene container (thin) -->
      <div class="vhs-overlay vhs-scanlines"></div>
      <div class="vhs-overlay vhs-static"></div>
      <div class="vhs-overlay vhs-chroma"></div>
    </div>

    <div id="password-box">
      <input type="password" id="passwordInput" autocomplete="off" />
    </div>

    <div id="bottom-left-symbol">ð“‚€</div>
  </div>

  <div id="bottom-text">Sorry, Come back later</div>
</div>

<!-- Global VHS overlays (cover entire viewport) -->
<div class="vhs-overlay vhs-glitch"></div>
<div class="vhs-overlay vhs-vertical-lines"></div>
<div class="vhs-overlay vhs-static"></div>
<div class="vhs-overlay vhs-chroma"></div>
<div class="vhs-vignette"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// Prevent right-click
document.addEventListener('contextmenu', e => e.preventDefault());

// Timer
let startTime = Date.now();
const timerEl = document.getElementById("timer");
function updateTimer(){
  const elapsed = Math.floor((Date.now() - startTime) / 1000);
  const hrs = String(Math.floor(elapsed / 3600)).padStart(2,'0');
  const mins = String(Math.floor((elapsed % 3600) / 60)).padStart(2,'0');
  const secs = String(elapsed % 60).padStart(2,'0');
  timerEl.textContent = `${hrs}:${mins}:${secs}`;
  return elapsed;
}

// THREE scene (kept from original)
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, 300/250, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true,alpha:true,canvas:document.getElementById('scene')});
const sceneContainer = document.getElementById("scene-container");

function resizeRenderer(){
  const rect = sceneContainer.getBoundingClientRect();
  renderer.setSize(rect.width, rect.height, false);
  camera.aspect = rect.width / rect.height;
  camera.updateProjectionMatrix();
}
resizeRenderer();
window.addEventListener('resize', resizeRenderer);

// Tetrahedron
const geometry = new THREE.TetrahedronGeometry(1);
const material = new THREE.MeshBasicMaterial({color:0xffffff,wireframe:true});
const tetrahedron = new THREE.Mesh(geometry, material);
scene.add(tetrahedron);
camera.position.z = 3;
let scale = .01, growing = true, turnedRed = false, spinSpeed = .01;

function animate(){
  requestAnimationFrame(animate);
  const elapsed = updateTimer();
  if(growing){ scale += .01; if(scale >= 1) growing = false; tetrahedron.scale.set(scale,scale,scale); }
  if(elapsed >= 720 && !turnedRed){
    material.color.set(0xff0000);
    material.needsUpdate = true;
    turnedRed = true;
    document.querySelector('canvas').classList.add('red-glow-canvas');
    spinSpeed = .05;
  }
  tetrahedron.rotation.z += spinSpeed;
  tetrahedron.rotation.y += spinSpeed;
  renderer.render(scene, camera);
}
animate();

// small randomized "spikes" in overlay opacity to simulate tape glitches
(function glitchPulse(){
  const glitchEls = document.querySelectorAll('.vhs-glitch, .vhs-static, .vhs-chroma, .vhs-scanlines');
  function pulse(){
    glitchEls.forEach(el=>{
      el.style.opacity = (0.04 + Math.random()*0.08).toFixed(2);
      if(Math.random() < 0.07){ el.style.opacity = (0.08 + Math.random()*0.22).toFixed(2); }
    });
    const delay = 100 + Math.random()*1200;
    setTimeout(pulse, delay);
  }
  pulse();
})();

// tiny whole-screen "roll" effect occasionally
(function occasionalRoll(){
  const root = document.querySelector('.wrapper');
  function roll(){
    root.style.transform = `translate3d(0,${(Math.random()*8-4)}px,0) rotate(${(Math.random()*0.6-0.3)}deg)`;
    setTimeout(()=> root.style.transform = '', 140 + Math.random()*320);
    setTimeout(roll, 3000 + Math.random()*9000);
  }
  roll();
})();

// PASSWORD CHECK - now uses server API to unlock
const input = document.getElementById("passwordInput");
input.addEventListener("keydown", async function(e){
  if(e.key !== "Enter") return;
  const pwd = (input.value || "").trim();
  if(!pwd){ alert("Enter password"); return; }
  try {
    const res = await fetch('/api/unlock', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ password: pwd })
    });
    const j = await res.json();
    if(!j.ok){ alert(j.error || 'Incorrect password'); return; }
    // redirect to server-served secret (protected) page
    window.location.href = '/secret?id=' + encodeURIComponent(j.id);
  } catch(err){
    console.error(err);
    alert('Network error or server down');
  }
});

// small accessibility: focus input on load
window.addEventListener('load', ()=>{ try{ document.getElementById('passwordInput')?.focus() }catch(e){} });
</script>

</body>
</html>
